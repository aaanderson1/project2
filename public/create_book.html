<!DOCTYPE html>
<html>

<head>
    <title>Create Book</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</head>

<body>
    <div>
        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <div>
                    <input type="text" class="form-control" id="title" placeholder="Book Title">
                </div>
                <div>
                    <input type="text" class="form-control" id="authorFirstName" placeholder="Author First Name">
                </div>
                <div>
                    <input type="text" class="form-control" id="authorLastName" placeholder="Author Last Name">
                </div>
                <div>
                    <input type="text" class="form-control" id="genre" placeholder="Genre">
                </div>
                <div>
                    <input type="text" class="form-control" id="numberOfPages" placeholder="Number of Pages">
                </div>
                <div>
                    <input type="text" class="form-control" id="comments" placeholder="Comments">
                </div>
                <div>
                    <input type="text" class="form-control" id="rating" placeholder="Rating">
                </div>
            </div>
            <button type="button" class="btn btn-primary" id="createnewbutton">Create New</button>
        </div>
    </div>
    <div>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Title</th>
                    <th scope="col">Autho</th>
                    <th scope="col">Genre</th>
                    <th scope="col">Pages</th>
                    <th scope="col">Comments</th>
                    <th scope="col">Rating</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="js/book_service.js"></script>
    <script>
        (() => {
            const bookService = new BookService();
            if (!bookService.loggedIn()) {
                window.location = window.location.origin + "/login.html";
                return;
            }

            bookService.getBooks().then((books) => {
                for (const book of books) {
                    $("#tableBody").append(`
                <tr>
                    <th scope="row">${book.id}</th>
                    <td>${book.title}</td>
                    <td>${book.author}</td>
                    <td>${book.genre}</td>
                    <td>${book.pages}</td>
                    <td>${book.comments}</td>
                    <td>${book.rating}</td>
                </tr>
                    `);
                }
            });

            $("#createnewbutton").click(() => {
                const data = {
                    title: $("#title").val(),
                    author: $("#authorFirstName").val() + " " + $("#authorLastName").val(),
                    genre: $("#genre").val(),
                    pages: $("#numberOfPages").val(),
                    comments: $("#comments").val(),
                    rating: $("#rating").val(),
                };
                if (!data.title) {
                    alert("title not provided");
                    return;
                }
                if (!data.author) {
                    alert("author not provided");
                    return;
                }
                if (!data.genre) {
                    alert("genre not provided");
                    return;
                }
                if (!data.pages) {
                    alert("pages not provided");
                    return;
                }
                if (!data.comments) {
                    alert("comments not provided");
                    return;
                }
                if (!data.rating || data.rating < 1 || data.rating > 5) {
                    alert("rating not provided or is not from 1 to 5");
                    return;
                }
                bookService
                    .createBook(data)
                    .then(() => {
                        window.location.reload();
                    }, (err) => {
                        alert(`Failed with error: ${err}`);
                    });
            });
        })();
    </script>
</body>

</html>